<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Stock Screener Pro | æ—¥æœ¬æ ªã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“ˆ</text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#070b12;color:#e2e8f0;font-family:'Noto Sans JP','Helvetica Neue',sans-serif;min-height:100vh}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:#070b12}::-webkit-scrollbar-thumb{background:#1e293b;border-radius:3px}
select,input{outline:none}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo } = React;

/* â•â•â• J-Quants API Client (V1 Token / V2 API Key) â•â•â• */
const API_V1 = "https://api.jquants.com/v1";
const API_V2 = "https://api.jquants.com/v2";

class JQuantsClient {
  constructor(){ this.idToken=null; this.apiKey=null; this.ver=null; }
  configV2(k){ this.apiKey=k; this.ver="v2"; this.idToken=null; }
  async configV1(email,pw){
    this.ver="v1"; this.apiKey=null;
    const r1=await fetch(`${API_V1}/token/auth_user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mailaddress:email,password:pw})});
    if(!r1.ok) throw new Error(`èªè¨¼å¤±æ•—(${r1.status})`);
    const {refreshToken}=await r1.json();
    const r2=await fetch(`${API_V1}/token/auth_refresh?refreshtoken=${refreshToken}`,{method:"POST"});
    if(!r2.ok) throw new Error(`IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å¤±æ•—(${r2.status})`);
    const d=await r2.json(); this.idToken=d.idToken||d.IdToken;
  }
  _h(){ return this.ver==="v2"?{"x-api-key":this.apiKey}:{Authorization:`Bearer ${this.idToken}`}; }
  _b(){ return this.ver==="v2"?API_V2:API_V1; }
  ok(){ return(this.ver==="v2"&&this.apiKey)||(this.ver==="v1"&&this.idToken); }
  async _get(p,q={}){ const qs=new URLSearchParams(q).toString(); const r=await fetch(`${this._b()}${p}${qs?"?"+qs:""}`,{headers:this._h()}); if(!r.ok) throw new Error(`API Error ${r.status}`); return r.json(); }
  async getList(c){ return this._get("/listed/info",c?{code:c}:{}); }
  async getQuotes(c,f,t){ return this._get(this.ver==="v2"?"/equities/bars/daily":"/prices/daily_quotes",{code:c,from:f,to:t}); }
  async getFin(c){ return this._get(this.ver==="v2"?"/fins/summary":"/fins/statements",{code:c}); }
}
const jqC = new JQuantsClient();

/* â•â•â• Local Storage Helper â•â•â• */
const LS = {
  get(k){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):null; }catch{return null;} },
  set(k,v){ try{ localStorage.setItem(k,JSON.stringify(v)); }catch{} }
};

/* â•â•â• Sample Data â•â•â• */
function gP(base,trend,vol,n=76){
  const p=[base],v=[];
  for(let i=1;i<n;i++){p.push(Math.round(p[i-1]*(1+(Math.random()-0.48)*vol+trend)));v.push(Math.round((5+Math.random()*10)*1e6));}
  v.push(Math.round((5+Math.random()*10)*1e6)); return{prices:p,volumes:v};
}
const SAMPLE=[
  {code:"7203",name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",sector:"è¼¸é€ç”¨æ©Ÿå™¨",...gP(2680,.003,.015),per:10.2,pbr:1.08,roe:10.6,divYield:2.8,equityRatio:42,opMargin:8.5,earningsGr:12.1,consDiv:5,esgE:68,esgS:74,esgG:75,marketCap:42000},
  {code:"6758",name:"ã‚½ãƒ‹ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—",sector:"é›»æ°—æ©Ÿå™¨",...gP(2950,.004,.018),per:16.8,pbr:2.15,roe:12.8,divYield:0.6,equityRatio:38,opMargin:12.3,earningsGr:8.4,consDiv:2,esgE:75,esgS:80,esgG:79,marketCap:18000},
  {code:"9984",name:"ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯G",sector:"æƒ…å ±ãƒ»é€šä¿¡æ¥­",...gP(8200,.006,.025),per:22.5,pbr:1.85,roe:8.2,divYield:0.5,equityRatio:22,opMargin:15.2,earningsGr:25.3,consDiv:0,esgE:52,esgS:60,esgG:62,marketCap:13000},
  {code:"8306",name:"ä¸‰è±UFJ FG",sector:"éŠ€è¡Œæ¥­",...gP(1350,.004,.012),per:11.5,pbr:0.85,roe:7.4,divYield:3.2,equityRatio:5,opMargin:32.1,earningsGr:6.8,consDiv:4,esgE:65,esgS:72,esgG:73,marketCap:21000},
  {code:"4502",name:"æ­¦ç”°è–¬å“å·¥æ¥­",sector:"åŒ»è–¬å“",...gP(4300,-.003,.012),per:28.5,pbr:1.12,roe:3.9,divYield:4.4,equityRatio:48,opMargin:14.8,earningsGr:-2.1,consDiv:12,esgE:80,esgS:85,esgG:81,marketCap:7200},
  {code:"6861",name:"ã‚­ãƒ¼ã‚¨ãƒ³ã‚¹",sector:"é›»æ°—æ©Ÿå™¨",...gP(62000,.004,.016),per:42.5,pbr:8.5,roe:20.0,divYield:0.3,equityRatio:94,opMargin:55.2,earningsGr:15.6,consDiv:8,esgE:60,esgS:68,esgG:67,marketCap:16000},
  {code:"8058",name:"ä¸‰è±å•†äº‹",sector:"å¸å£²æ¥­",...gP(2500,.004,.014),per:9.8,pbr:1.1,roe:11.2,divYield:3.5,equityRatio:35,opMargin:6.8,earningsGr:5.5,consDiv:7,esgE:72,esgS:70,esgG:76,marketCap:11000},
  {code:"6501",name:"æ—¥ç«‹è£½ä½œæ‰€",sector:"é›»æ°—æ©Ÿå™¨",...gP(3800,.004,.015),per:18.5,pbr:2.8,roe:15.1,divYield:1.2,equityRatio:32,opMargin:9.8,earningsGr:18.2,consDiv:3,esgE:78,esgS:76,esgG:80,marketCap:15000},
  {code:"9432",name:"æ—¥æœ¬é›»ä¿¡é›»è©±",sector:"æƒ…å ±ãƒ»é€šä¿¡æ¥­",...gP(155,.003,.01),per:12.5,pbr:1.5,roe:12.0,divYield:3.0,equityRatio:35,opMargin:16.5,earningsGr:4.2,consDiv:13,esgE:70,esgS:72,esgG:78,marketCap:14000},
  {code:"7974",name:"ä»»å¤©å ‚",sector:"ãã®ä»–è£½å“",...gP(8200,.003,.014),per:20.5,pbr:3.2,roe:15.6,divYield:2.5,equityRatio:80,opMargin:35.2,earningsGr:22.0,consDiv:10,esgE:62,esgS:70,esgG:72,marketCap:10000},
  {code:"2914",name:"JT",sector:"é£Ÿæ–™å“",...gP(3900,.001,.008),per:13.8,pbr:1.9,roe:13.8,divYield:4.8,equityRatio:52,opMargin:28.5,earningsGr:6.5,consDiv:20,esgE:55,esgS:58,esgG:68,marketCap:7800},
  {code:"4063",name:"ä¿¡è¶ŠåŒ–å­¦å·¥æ¥­",sector:"åŒ–å­¦",...gP(5200,.004,.014),per:15.2,pbr:2.3,roe:15.1,divYield:2.2,equityRatio:82,opMargin:32.5,earningsGr:10.5,consDiv:6,esgE:73,esgS:71,esgG:74,marketCap:12000},
  {code:"9433",name:"KDDI",sector:"æƒ…å ±ãƒ»é€šä¿¡æ¥­",...gP(4600,.001,.006),per:14.2,pbr:1.8,roe:12.7,divYield:3.1,equityRatio:45,opMargin:20.2,earningsGr:5.8,consDiv:22,esgE:71,esgS:73,esgG:77,marketCap:10500},
  {code:"3382",name:"ã‚»ãƒ–ãƒ³&ã‚¢ã‚¤",sector:"å°å£²æ¥­",...gP(2100,-.003,.012),per:18.0,pbr:1.3,roe:7.2,divYield:2.8,equityRatio:30,opMargin:5.5,earningsGr:-5.2,consDiv:3,esgE:66,esgS:70,esgG:65,marketCap:5000},
  {code:"6902",name:"ãƒ‡ãƒ³ã‚½ãƒ¼",sector:"è¼¸é€ç”¨æ©Ÿå™¨",...gP(2100,.004,.015),per:12.8,pbr:1.15,roe:9.0,divYield:2.5,equityRatio:50,opMargin:7.8,earningsGr:9.5,consDiv:4,esgE:78,esgS:72,esgG:70,marketCap:7500},
  {code:"8766",name:"æ±äº¬æµ·ä¸ŠHD",sector:"ä¿é™ºæ¥­",...gP(3500,.004,.013),per:11.2,pbr:1.65,roe:14.7,divYield:3.3,equityRatio:18,opMargin:18.5,earningsGr:14.2,consDiv:9,esgE:74,esgS:76,esgG:82,marketCap:10000},
  {code:"4568",name:"ç¬¬ä¸€ä¸‰å…±",sector:"åŒ»è–¬å“",...gP(4500,.005,.02),per:35.0,pbr:5.2,roe:14.9,divYield:0.8,equityRatio:55,opMargin:18.2,earningsGr:28.5,consDiv:4,esgE:76,esgS:82,esgG:78,marketCap:11000},
  {code:"6367",name:"ãƒ€ã‚¤ã‚­ãƒ³å·¥æ¥­",sector:"æ©Ÿæ¢°",...gP(23000,.002,.012),per:28.0,pbr:4.5,roe:16.1,divYield:0.9,equityRatio:52,opMargin:13.5,earningsGr:11.2,consDiv:10,esgE:82,esgS:75,esgG:78,marketCap:8500},
  {code:"5401",name:"æ—¥æœ¬è£½é‰„",sector:"é‰„é‹¼",...gP(3200,-.002,.013),per:7.5,pbr:0.65,roe:8.7,divYield:5.0,equityRatio:42,opMargin:9.2,earningsGr:-8.5,consDiv:2,esgE:58,esgS:62,esgG:66,marketCap:3200},
  {code:"6594",name:"ãƒ‹ãƒ‡ãƒƒã‚¯",sector:"é›»æ°—æ©Ÿå™¨",...gP(7200,.004,.018),per:30.0,pbr:3.8,roe:12.7,divYield:0.7,equityRatio:45,opMargin:11.5,earningsGr:20.5,consDiv:5,esgE:70,esgS:66,esgG:68,marketCap:4800},
];

/* â•â•â• Technical Indicators â•â•â• */
const calcMA=(p,n)=>p.length<n?null:p.slice(-n).reduce((a,b)=>a+b,0)/n;
function calcRSI(p,n=14){if(p.length<n+1)return 50;let g=0,l=0;for(let i=p.length-n;i<p.length;i++){const d=p[i]-p[i-1];if(d>0)g+=d;else l-=d;}return l===0?100:+(100-100/(1+g/l)).toFixed(1);}
function detectCross(prices,sP=5,lP=25,lb=5){let golden=false,dead=false;if(prices.length<lP+lb)return{golden,dead};for(let i=prices.length-lb;i<prices.length;i++){const pS=calcMA(prices.slice(0,i),sP),pL=calcMA(prices.slice(0,i),lP),cS=calcMA(prices.slice(0,i+1),sP),cL=calcMA(prices.slice(0,i+1),lP);if(pS&&pL&&cS&&cL){if(pS<=pL&&cS>cL)golden=true;if(pS>=pL&&cS<cL)dead=true;}}return{golden,dead};}

/* â•â•â• Scoring Engine (100pt) with Sell-Risk Discount â•â•â• */
function scoreStock(s){
  const p=s.prices,cur=p[p.length-1],prev=p[p.length-2];
  const ma5=calcMA(p,5),ma25=calcMA(p,25),ma75=calcMA(p,75);
  const rsi=calcRSI(p);
  const avgVol=s.volumes.slice(-25).reduce((a,b)=>a+b,0)/25;
  const curVol=s.volumes[s.volumes.length-1];
  const ma25dev=ma25?+((cur-ma25)/ma25*100).toFixed(1):0;
  const{golden:goldenCross,dead:deadCross}=detectCross(p);

  // Valuation (30pt)
  let V=0;const vD=[];
  if(s.per>=5&&s.per<=15){V+=10;vD.push({t:`PER ${s.per}å€ï¼šå‰²å®‰åœï¼ˆ5ã€œ15å€ï¼‰`,s:true});}else if(s.per<=25){V+=5;vD.push({t:`PER ${s.per}å€ï¼šé©æ­£åœ`,s:null});}else{V+=1;vD.push({t:`PER ${s.per}å€ï¼šå‰²é«˜åœ`,s:false});}
  if(s.pbr>=0.5&&s.pbr<=1.2){V+=10;vD.push({t:`PBR ${s.pbr}å€ï¼šå‰²å®‰åœ`,s:true});}else if(s.pbr<=2.5){V+=5;vD.push({t:`PBR ${s.pbr}å€ï¼šé©æ­£åœ`,s:null});}else{V+=1;vD.push({t:`PBR ${s.pbr}å€ï¼šå‰²é«˜åœ`,s:false});}
  if(s.divYield>=3){V+=10;vD.push({t:`é…å½“åˆ©å›ã‚Š ${s.divYield}%ï¼šé«˜é…å½“`,s:true});}else if(s.divYield>=1.5){V+=5;vD.push({t:`é…å½“åˆ©å›ã‚Š ${s.divYield}%ï¼šæ¨™æº–`,s:null});}else{V+=1;vD.push({t:`é…å½“åˆ©å›ã‚Š ${s.divYield}%ï¼šä½æ°´æº–`,s:false});}

  // Quality (30pt)
  let Q=0;const qD=[];
  if(s.roe>=15){Q+=10;qD.push({t:`ROE ${s.roe}%ï¼šé«˜è³‡æœ¬åŠ¹ç‡`,s:true});}else if(s.roe>=8){Q+=7;qD.push({t:`ROE ${s.roe}%ï¼šè‰¯å¥½`,s:true});}else{Q+=2;qD.push({t:`ROE ${s.roe}%ï¼šä½æ°´æº–`,s:false});}
  if(s.opMargin>=20){Q+=5;qD.push({t:`å–¶æ¥­åˆ©ç›Šç‡ ${s.opMargin}%ï¼šé«˜åç›Š`,s:true});}else if(s.opMargin>=10){Q+=3;qD.push({t:`å–¶æ¥­åˆ©ç›Šç‡ ${s.opMargin}%ï¼šè‰¯å¥½`,s:null});}else{Q+=1;qD.push({t:`å–¶æ¥­åˆ©ç›Šç‡ ${s.opMargin}%ï¼šä½ã‚`,s:false});}
  if(s.equityRatio>=40){Q+=5;qD.push({t:`è‡ªå·±è³‡æœ¬æ¯”ç‡ ${s.equityRatio}%ï¼šå¥å…¨`,s:true});}else if(s.equityRatio>=25){Q+=3;qD.push({t:`è‡ªå·±è³‡æœ¬æ¯”ç‡ ${s.equityRatio}%ï¼šæ¨™æº–`,s:null});}else{Q+=0;qD.push({t:`è‡ªå·±è³‡æœ¬æ¯”ç‡ ${s.equityRatio}%ï¼šè¦æ³¨æ„`,s:false});}
  if(s.earningsGr>=10){Q+=5;qD.push({t:`åˆ©ç›Šæˆé•·ç‡ ${s.earningsGr}%ï¼šé«˜æˆé•·`,s:true});}else if(s.earningsGr>=5){Q+=3;qD.push({t:`åˆ©ç›Šæˆé•·ç‡ ${s.earningsGr}%ï¼šæˆé•·ä¸­`,s:true});}else if(s.earningsGr>=0){Q+=1;qD.push({t:`åˆ©ç›Šæˆé•·ç‡ ${s.earningsGr}%ï¼šæ¨ªã°ã„`,s:null});}else{Q+=0;qD.push({t:`åˆ©ç›Šæˆé•·ç‡ ${s.earningsGr}%ï¼šæ¸›ç›Š`,s:false});}
  if(s.consDiv>=3){Q+=5;qD.push({t:`é€£ç¶šå¢—é… ${s.consDiv}å¹´ï¼šå®‰å®šé‚„å…ƒ`,s:true});}else{Q+=1;qD.push({t:`é€£ç¶šå¢—é… ${s.consDiv}å¹´`,s:null});}

  // Momentum (25pt)
  let M=0;const mD=[];
  if(ma25dev>=-5&&ma25dev<=3){M+=8;mD.push({t:`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼šæŠ¼ã—ç›®åœ`,s:true});}else if(ma25dev>3&&ma25dev<=10){M+=4;mD.push({t:`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼šä¸Šæ˜‡ä¸­`,s:null});}else if(ma25dev<-5){M+=2;mD.push({t:`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼šä¸‹è½åœ`,s:false});}else{M+=1;mD.push({t:`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼šéç†±åœ`,s:false});}
  if(goldenCross){M+=7;mD.push({t:"ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ç™ºç”Ÿï¼ˆç›´è¿‘5æ—¥ï¼‰",s:true});}else{M+=2;mD.push({t:"ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹æœªç™ºç”Ÿ",s:null});}
  if(rsi>=30&&rsi<=55){M+=5;mD.push({t:`RSI ${rsi}ï¼šè²·ã„é©æ­£åœ`,s:true});}else if(rsi>55&&rsi<=70){M+=3;mD.push({t:`RSI ${rsi}ï¼šã‚„ã‚„å¼·ã‚`,s:null});}else if(rsi<30){M+=4;mD.push({t:`RSI ${rsi}ï¼šå£²ã‚‰ã‚Œéã`,s:true});}else{M+=0;mD.push({t:`RSI ${rsi}ï¼šè²·ã‚ã‚Œéãåœ`,s:false});}
  if(curVol>avgVol*1.2){M+=5;mD.push({t:`å‡ºæ¥é«˜å€ç‡ ${(curVol/avgVol).toFixed(2)}xï¼šæ´»ç™º`,s:true});}else{M+=2;mD.push({t:`å‡ºæ¥é«˜å€ç‡ ${(curVol/avgVol).toFixed(2)}xï¼šé€šå¸¸`,s:null});}

  // ESG (15pt)
  let E=0;const eD=[];const esgAvg=Math.round((s.esgE+s.esgS+s.esgG)/3);
  if(esgAvg>=75){E+=6;eD.push({t:`ESGç·åˆ ${esgAvg}ï¼šå„ªè‰¯`,s:true});}else if(esgAvg>=65){E+=4;eD.push({t:`ESGç·åˆ ${esgAvg}ï¼šæ¨™æº–`,s:null});}else{E+=1;eD.push({t:`ESGç·åˆ ${esgAvg}ï¼šæ”¹å–„ä½™åœ°ã‚ã‚Š`,s:false});}
  E+=s.esgE>=70?3:1;eD.push({t:`ç’°å¢ƒ(E): ${s.esgE}`,s:s.esgE>=70});
  E+=s.esgS>=70?3:1;eD.push({t:`ç¤¾ä¼š(S): ${s.esgS}`,s:s.esgS>=70});
  E+=s.esgG>=70?3:1;eD.push({t:`ã‚¬ãƒãƒŠãƒ³ã‚¹(G): ${s.esgG}`,s:s.esgG>=70});

  const baseTotal=V+Q+M+E;

  // â˜… Sell-Risk Discount
  let sellDiscount=0;const sellRiskFactors=[];
  if(rsi>=75){sellDiscount+=15;sellRiskFactors.push(`RSI ${rsi}ï¼ˆè²·ã‚ã‚Œéãï¼šâˆ’15ptï¼‰`);}else if(rsi>=70){sellDiscount+=8;sellRiskFactors.push(`RSI ${rsi}ï¼ˆéç†±æ¥è¿‘ï¼šâˆ’8ptï¼‰`);}
  if(deadCross){sellDiscount+=12;sellRiskFactors.push("ãƒ‡ãƒƒãƒ‰ã‚¯ãƒ­ã‚¹ç™ºç”Ÿï¼ˆâˆ’12ptï¼‰");}
  if(ma25dev>=15){sellDiscount+=12;sellRiskFactors.push(`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼ˆéç†±ï¼šâˆ’12ptï¼‰`);}else if(ma25dev>=10){sellDiscount+=5;sellRiskFactors.push(`MA25ä¹–é›¢ç‡ ${ma25dev}%ï¼ˆã‚„ã‚„éç†±ï¼šâˆ’5ptï¼‰`);}
  if(rsi>=65&&ma25dev>=8&&rsi<70&&ma25dev<10){sellDiscount+=5;sellRiskFactors.push("è¤‡åˆéç†±ï¼ˆRSI+ä¹–é›¢ç‡ï¼šâˆ’5ptï¼‰");}

  const total=Math.max(0,baseTotal-sellDiscount);
  const avgV=s.volumes.slice(-25).reduce((a,b)=>a+b,0)/25;
  const excluded=(s.marketCap||99999)<300||avgV<500000||s.equityRatio<20||s.per<0;
  return{code:s.code,name:s.name,sector:s.sector,price:cur,prevPrice:prev,change:cur-prev,changePct:+((cur-prev)/prev*100).toFixed(2),baseTotal,sellDiscount,total,V,Q,M,E,vD,qD,mD,eD,sellRiskFactors,rsi,ma5,ma25,ma75,ma25dev,goldenCross,deadCross,excluded,buyCandidate:total>=65&&!excluded,targetProfit:+(cur*1.20).toFixed(0),stopLoss:+(cur*0.92).toFixed(0),holdPeriod:total>=70?"1ã€œ3ãƒ¶æœˆ":"3ã€œ6ãƒ¶æœˆ"};
}

/* â•â•â• Styles â•â•â• */
const C={bg:"#070b12",card:"#0d1219",border:"#182033",accent:"#3b82f6",green:"#10b981",red:"#ef4444",amber:"#f59e0b",purple:"#8b5cf6",cyan:"#06b6d4",text:"#e2e8f0",muted:"#64748b",subtle:"#1e293b"};
const crd={background:C.card,border:`1px solid ${C.border}`,borderRadius:10,padding:16};
const btn={border:"none",borderRadius:8,padding:"8px 16px",fontSize:12,fontWeight:600,cursor:"pointer",transition:"all 0.15s",fontFamily:"inherit"};
const inp={width:"100%",padding:"8px 12px",background:C.bg,border:`1px solid ${C.border}`,borderRadius:6,color:C.text,fontSize:13,fontFamily:"'JetBrains Mono',monospace"};

/* â•â•â• Components â•â•â• */
const Badge=({score})=>{let l,c;if(score>=75){l="å¼·ã„è²·ã„";c=C.green;}else if(score>=65){l="è²·ã„";c=C.cyan;}else if(score>=50){l="ã‚„ã‚„è²·ã„";c=C.accent;}else if(score>=35){l="ä¸­ç«‹";c=C.muted;}else{l="è¦‹é€ã‚Š";c=C.red;}return React.createElement("span",{style:{fontSize:11,fontWeight:700,color:c,background:`${c}18`,padding:"3px 10px",borderRadius:20,whiteSpace:"nowrap"}},l);};
const Bar=({v,max,color})=>React.createElement("div",{style:{flex:1,height:5,background:C.border,borderRadius:3,overflow:"hidden"}},React.createElement("div",{style:{width:`${Math.min(100,(v/max)*100)}%`,height:"100%",background:color,borderRadius:3,transition:"width 0.4s"}}));
const Item=({d})=>React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 0",fontSize:12,color:C.text,borderBottom:`1px solid ${C.border}`}},React.createElement("span",{style:{color:d.s===true?C.green:d.s===false?C.red:C.muted,fontSize:9}},d.s===true?"â–²":d.s===false?"â–¼":"â—"),d.t);
const Overlay=({children,wide})=>React.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999}},React.createElement("div",{style:{...crd,width:wide?500:380,padding:22,maxHeight:"90vh",overflowY:"auto"}},children));
const Lbl=({label,children})=>React.createElement("label",{style:{display:"block",fontSize:11,color:C.muted,marginTop:4}},label,React.createElement("div",{style:{marginTop:3}},children));

/* â•â•â• Main App â•â•â• */
function App(){
  const[view,setView]=useState("screen");
  const[detail,setDetail]=useState(null);
  const[portfolio,setPortfolio]=useState(()=>LS.get("pf3")||[]);
  const[history,setHistory]=useState(()=>LS.get("hist3")||[]);
  const[cfg,setCfg]=useState(()=>LS.get("cfg3")||{budget:3000000,maxH:8,apiVersion:"none",apiKey:"",email:"",password:""});
  const[modal,setModal]=useState(null);
  const[sort,setSort]=useState("total");
  const[apiStatus,setApiStatus]=useState({connected:false,error:null,dataSource:"sample"});

  const savePf=(d)=>{setPortfolio(d);LS.set("pf3",d);};
  const saveHist=(d)=>{setHistory(d);LS.set("hist3",d);};
  const saveCfg=(d)=>{setCfg(d);LS.set("cfg3",d);};

  const allScored=useMemo(()=>SAMPLE.map(scoreStock),[]);
  const sorted=useMemo(()=>{const a=[...allScored];a.sort((x,y)=>sort==="V"?y.V-x.V:sort==="Q"?y.Q-x.Q:sort==="M"?y.M-x.M:sort==="E"?y.E-x.E:y.total-x.total);return a;},[allScored,sort]);
  const buyCandidates=sorted.filter(s=>s.buyCandidate);
  const perUnit=cfg.maxH>0?Math.floor(cfg.budget/cfg.maxH):0;

  const alerts=useMemo(()=>{
    const now=Date.now();
    return portfolio.map(h=>{
      const sc=allScored.find(x=>x.code===h.code);if(!sc)return null;
      const days=Math.floor((now-new Date(h.buyDate).getTime())/86400000);
      if(days<2)return null;
      const pnl=(sc.price-h.buyPrice)/h.buyPrice*100;const reasons=[];
      if(pnl>=20)reasons.push("âœ… å«ã¿ç›Š+20%åˆ°é”ï¼ˆåˆ©ç¢ºæ¨å¥¨ï¼‰");
      if(pnl<=-8)reasons.push("ğŸ”» å«ã¿æâˆ’8%åˆ°é”ï¼ˆæåˆ‡æ¨å¥¨ï¼‰");
      if(sc.rsi>=75)reasons.push(`ğŸ“ˆ RSI ${sc.rsi}ï¼ˆè²·ã‚ã‚Œéãåœï¼‰`);
      if(sc.deadCross)reasons.push("ğŸ“‰ ãƒ‡ãƒƒãƒ‰ã‚¯ãƒ­ã‚¹ç™ºç”Ÿ");
      if(sc.ma25dev>=15)reasons.push(`ğŸ“Š MA25ä¹–é›¢ç‡ ${sc.ma25dev}%ï¼ˆéç†±ï¼‰`);
      if(days>180&&pnl<5)reasons.push(`â° ä¿æœ‰${days}æ—¥ãƒ»å«ã¿ç›Š${pnl.toFixed(1)}%`);
      return reasons.length?{...h,reasons,pnl:+pnl.toFixed(2),curPrice:sc.price}:null;
    }).filter(Boolean);
  },[portfolio,allScored]);

  const testApi=async()=>{
    try{setApiStatus(p=>({...p,error:null}));
      if(cfg.apiVersion==="v2")jqC.configV2(cfg.apiKey);else if(cfg.apiVersion==="v1")await jqC.configV1(cfg.email,cfg.password);else{setApiStatus({connected:false,error:"APIæ–¹å¼ã‚’é¸æŠã—ã¦ãã ã•ã„",dataSource:"sample"});return;}
      await jqC.getList("72030");setApiStatus({connected:true,error:null,dataSource:"J-Quants API"});
    }catch(e){let m=e.message;if(m.includes("fetch")||m.includes("CORS"))m="CORSåˆ¶é™ã‚¨ãƒ©ãƒ¼ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥APIã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã®æ¥ç¶šãŒå¿…è¦ã§ã™ã€‚";setApiStatus({connected:false,error:m,dataSource:"sample"});}
  };

  /* â”€â”€ Buy Modal â”€â”€ */
  const BuyModal=()=>{
    const s=modal.data;
    const[shares,setShares]=useState(Math.max(1,Math.floor(perUnit/s.price)));
    const[price,setPrice]=useState(s.price);
    const[date,setDate]=useState(new Date().toISOString().slice(0,10));
    return React.createElement(Overlay,null,
      React.createElement("h3",{style:{fontSize:15,fontWeight:700,marginBottom:14,color:C.text}},"ğŸ“ è³¼å…¥è¨˜éŒ²ï¼š"+s.name),
      React.createElement("div",{style:{display:"grid",gap:10}},
        React.createElement(Lbl,{label:"è³¼å…¥æ ªæ•°"},React.createElement("input",{type:"number",value:shares,onChange:e=>setShares(+e.target.value),style:inp})),
        React.createElement(Lbl,{label:"è³¼å…¥å˜ä¾¡ï¼ˆå††ï¼‰"},React.createElement("input",{type:"number",value:price,onChange:e=>setPrice(+e.target.value),style:inp})),
        React.createElement(Lbl,{label:"è³¼å…¥æ—¥"},React.createElement("input",{type:"date",value:date,onChange:e=>setDate(e.target.value),style:{...inp,fontFamily:"inherit"}})),
        React.createElement("div",{style:{fontSize:12,color:C.muted,background:C.bg,borderRadius:6,padding:10}},`æŠ•è³‡é‡‘é¡ï¼š`,React.createElement("strong",{style:{color:C.text}},"Â¥"+(shares*price).toLocaleString()))
      ),
      React.createElement("div",{style:{display:"flex",gap:8,marginTop:14}},
        React.createElement("button",{onClick:()=>{savePf([...portfolio,{code:s.code,name:s.name,shares,buyPrice:price,buyDate:date,id:Date.now().toString()}]);setModal(null);},style:{...btn,flex:1,background:C.green,color:"#fff"}},"è¨˜éŒ²ã™ã‚‹"),
        React.createElement("button",{onClick:()=>setModal(null),style:{...btn,flex:1,background:C.subtle,color:C.muted}},"ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
      )
    );
  };

  /* â”€â”€ Sell Modal â”€â”€ */
  const SellModal=()=>{
    const h=modal.data;const sc=allScored.find(x=>x.code===h.code);
    const[sp,setSp]=useState(sc?sc.price:h.buyPrice);
    const[sd,setSd]=useState(new Date().toISOString().slice(0,10));
    const pnl=(sp-h.buyPrice)*h.shares;const pnlP=((sp-h.buyPrice)/h.buyPrice*100).toFixed(2);
    return React.createElement(Overlay,null,
      React.createElement("h3",{style:{fontSize:15,fontWeight:700,marginBottom:14,color:C.text}},"ğŸ’° å£²å´è¨˜éŒ²ï¼š"+h.name),
      React.createElement("div",{style:{display:"grid",gap:10}},
        React.createElement("div",{style:{fontSize:12,color:C.muted}},`è³¼å…¥: Â¥${h.buyPrice.toLocaleString()} Ã— ${h.shares}æ ª`),
        React.createElement(Lbl,{label:"å£²å´å˜ä¾¡ï¼ˆå††ï¼‰"},React.createElement("input",{type:"number",value:sp,onChange:e=>setSp(+e.target.value),style:inp})),
        React.createElement(Lbl,{label:"å£²å´æ—¥"},React.createElement("input",{type:"date",value:sd,onChange:e=>setSd(e.target.value),style:{...inp,fontFamily:"inherit"}})),
        React.createElement("div",{style:{fontSize:13,background:C.bg,borderRadius:6,padding:10,color:pnl>=0?C.green:C.red,fontWeight:700}},`æç›Šï¼šÂ¥${pnl.toLocaleString()} (${pnl>=0?"+":""}${pnlP}%)`)
      ),
      React.createElement("div",{style:{display:"flex",gap:8,marginTop:14}},
        React.createElement("button",{onClick:()=>{saveHist([...history,{...h,sellPrice:sp,sellDate:sd,pnl,pnlPct:+pnlP}]);savePf(portfolio.filter(p=>p.id!==h.id));setModal(null);},style:{...btn,flex:1,background:pnl>=0?C.green:C.red,color:"#fff"}},"å£²å´ã‚’è¨˜éŒ²"),
        React.createElement("button",{onClick:()=>setModal(null),style:{...btn,flex:1,background:C.subtle,color:C.muted}},"ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
      )
    );
  };

  /* â”€â”€ Settings Modal â”€â”€ */
  const SettingsModal=()=>{
    const[lo,setLo]=useState({...cfg});
    return React.createElement(Overlay,{wide:true},
      React.createElement("h3",{style:{fontSize:15,fontWeight:700,marginBottom:14,color:C.text}},"âš™ è¨­å®š"),
      React.createElement("div",{style:{display:"grid",gap:12}},
        React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}},
          React.createElement(Lbl,{label:"æŠ•è³‡å¯èƒ½è³‡é‡‘ï¼ˆå††ï¼‰"},React.createElement("input",{type:"number",value:lo.budget,onChange:e=>setLo(s=>({...s,budget:+e.target.value})),style:inp})),
          React.createElement(Lbl,{label:"æœ€å¤§ä¿æœ‰éŠ˜æŸ„æ•°"},React.createElement("input",{type:"number",value:lo.maxH,onChange:e=>setLo(s=>({...s,maxH:+e.target.value})),style:inp}))
        ),
        React.createElement("div",{style:{fontSize:12,color:C.muted,background:C.bg,borderRadius:6,padding:10}},`1éŠ˜æŸ„ã‚ãŸã‚Šï¼š`,React.createElement("strong",{style:{color:C.text}},"Â¥"+(lo.maxH>0?Math.floor(lo.budget/lo.maxH):0).toLocaleString())),
        React.createElement("div",{style:{borderTop:`1px solid ${C.border}`,paddingTop:12}},
          React.createElement("div",{style:{fontSize:13,fontWeight:700,color:C.accent,marginBottom:8}},"ğŸ“¡ J-Quants API æ¥ç¶šè¨­å®š"),
          React.createElement(Lbl,{label:"APIæ–¹å¼"},
            React.createElement("select",{value:lo.apiVersion,onChange:e=>setLo(s=>({...s,apiVersion:e.target.value})),style:{...inp,fontFamily:"inherit"}},
              React.createElement("option",{value:"none"},"æœªæ¥ç¶šï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼‰"),
              React.createElement("option",{value:"v2"},"V2ï¼ˆAPIã‚­ãƒ¼æ–¹å¼ï¼‰â˜…æ¨å¥¨"),
              React.createElement("option",{value:"v1"},"V1ï¼ˆãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ–¹å¼ï¼‰")
            )
          ),
          lo.apiVersion==="v2"&&React.createElement("div",{style:{marginTop:8}},React.createElement(Lbl,{label:"APIã‚­ãƒ¼"},React.createElement("input",{type:"password",value:lo.apiKey,onChange:e=>setLo(s=>({...s,apiKey:e.target.value})),style:inp,placeholder:"your-api-key-here"}))),
          lo.apiVersion==="v1"&&React.createElement("div",{style:{marginTop:8,display:"grid",gap:8}},React.createElement(Lbl,{label:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"},React.createElement("input",{value:lo.email,onChange:e=>setLo(s=>({...s,email:e.target.value})),style:inp})),React.createElement(Lbl,{label:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"},React.createElement("input",{type:"password",value:lo.password,onChange:e=>setLo(s=>({...s,password:e.target.value})),style:inp}))),
          apiStatus.error&&React.createElement("div",{style:{marginTop:8,fontSize:11,color:C.red,background:C.red+"10",borderRadius:6,padding:10,lineHeight:1.7}},apiStatus.error),
          apiStatus.connected&&React.createElement("div",{style:{marginTop:8,fontSize:11,color:C.green,background:C.green+"10",borderRadius:6,padding:10}},"âœ… æ¥ç¶šæˆåŠŸ"),
          React.createElement("div",{style:{marginTop:10,fontSize:10,color:C.muted,background:C.subtle,borderRadius:6,padding:10,lineHeight:1.8}},
            React.createElement("strong",{style:{color:C.amber}},"âš  CORSå¯¾ç­–ã«ã¤ã„ã¦"),React.createElement("br"),
            "ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥ J-Quants API ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã€CORSåˆ¶é™ã«ã‚ˆã‚Šãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",React.createElement("br"),
            "â‘  ãƒ­ãƒ¼ã‚«ãƒ«ã«Node.jsãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã‚‹ï¼ˆæ¨å¥¨ï¼‰",React.createElement("br"),
            "â‘¡ ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰APIã‚’å‘¼ã³å‡ºã™æ§‹æˆã«ã™ã‚‹",React.createElement("br"),
            React.createElement("strong",{style:{color:C.cyan}},"å¿…è¦ãƒ—ãƒ©ãƒ³ï¼š"),
            " Lightãƒ—ãƒ©ãƒ³ä»¥ä¸Šï¼ˆæœˆé¡Â¥1,650ï¼‰ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—å¯èƒ½"
          )
        )
      ),
      React.createElement("div",{style:{display:"flex",gap:8,marginTop:14}},
        React.createElement("button",{onClick:()=>{saveCfg(lo);if(lo.apiVersion!=="none")testApi();setModal(null);},style:{...btn,flex:1,background:C.accent,color:"#fff"}},"ä¿å­˜"),
        lo.apiVersion!=="none"&&React.createElement("button",{onClick:()=>{setCfg(lo);testApi();},style:{...btn,background:C.cyan,color:"#fff"}},"æ¥ç¶šãƒ†ã‚¹ãƒˆ"),
        React.createElement("button",{onClick:()=>setModal(null),style:{...btn,background:C.subtle,color:C.muted}},"é–‰ã˜ã‚‹")
      )
    );
  };

  /* â”€â”€ Screen View â”€â”€ */
  const ScreenView=()=>React.createElement("div",null,
    alerts.length>0&&React.createElement("div",{style:{...crd,marginBottom:14,borderColor:C.red+"60",background:"#140808"}},
      React.createElement("div",{style:{fontSize:13,fontWeight:700,color:C.red,marginBottom:8}},`ğŸ”” å£²å´ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆ${alerts.length}ä»¶ï¼‰`),
      alerts.map((a,i)=>React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 0",borderBottom:i<alerts.length-1?`1px solid ${C.border}`:"none",flexWrap:"wrap",gap:6}},
        React.createElement("div",null,
          React.createElement("span",{style:{fontWeight:600,fontSize:13,color:C.text}},a.code+" "+a.name),
          React.createElement("span",{style:{fontSize:11,color:a.pnl>=0?C.green:C.red,marginLeft:8}},(a.pnl>=0?"+":"")+a.pnl+"%"),
          React.createElement("div",{style:{fontSize:11,color:C.amber,marginTop:2}},a.reasons.join("ã€€"))
        ),
        React.createElement("button",{onClick:()=>setModal({type:"sell",data:a}),style:{...btn,background:C.red,color:"#fff",fontSize:11}},"å£²å´è¨˜éŒ²")
      ))
    ),
    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,flexWrap:"wrap",gap:8}},
      React.createElement("div",null,
        React.createElement("span",{style:{fontSize:14,fontWeight:700}},"ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°çµæœ"),
        React.createElement("span",{style:{fontSize:12,color:C.green,marginLeft:8}},`è³¼å…¥å€™è£œ: ${buyCandidates.length}éŠ˜æŸ„`),
        React.createElement("span",{style:{fontSize:10,color:C.muted,marginLeft:8}},`ï¼ˆ${apiStatus.dataSource}ï¼‰`)
      ),
      React.createElement("div",{style:{display:"flex",gap:4,flexWrap:"wrap"}},
        [{k:"total",l:"ç·åˆ"},{k:"V",l:"ãƒãƒªãƒ¥ãƒ¼"},{k:"Q",l:"ã‚¯ã‚ªãƒªãƒ†ã‚£"},{k:"M",l:"ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ "},{k:"E",l:"ESG"}].map(s=>
          React.createElement("button",{key:s.k,onClick:()=>setSort(s.k),style:{...btn,padding:"4px 10px",fontSize:10,background:sort===s.k?C.accent:C.card,color:sort===s.k?"#fff":C.muted,border:`1px solid ${sort===s.k?C.accent:C.border}`}},s.l)
        )
      )
    ),
    React.createElement("div",{style:{display:"grid",gap:6}},
      sorted.map(st=>{
        const held=portfolio.some(p=>p.code===st.code);
        return React.createElement("div",{key:st.code,onClick:()=>{setDetail(st.code);setView("detail");},style:{...crd,padding:"10px 14px",cursor:"pointer",opacity:st.excluded?0.4:1,borderLeft:st.buyCandidate?`3px solid ${C.green}`:st.excluded?`3px solid ${C.red}`:`3px solid ${C.border}`}},
          React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:6}},
            React.createElement("div",{style:{minWidth:0,flex:"1 1 160px"}},
              React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}},
                React.createElement("span",{style:{fontFamily:"mono",fontSize:11,color:C.muted}},st.code),
                React.createElement("span",{style:{fontSize:13,fontWeight:700}},st.name),
                held&&React.createElement("span",{style:{fontSize:8,background:C.purple+"30",color:C.purple,padding:"2px 5px",borderRadius:4,fontWeight:600}},"ä¿æœ‰ä¸­"),
                st.sellDiscount>0&&React.createElement("span",{style:{fontSize:8,background:C.amber+"20",color:C.amber,padding:"2px 5px",borderRadius:4}},`âˆ’${st.sellDiscount}pt`)
              ),
              React.createElement("div",{style:{fontSize:10,color:C.muted}},st.sector)
            ),
            React.createElement("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"}},
              React.createElement("div",{style:{textAlign:"right",minWidth:80}},
                React.createElement("div",{style:{fontFamily:"mono",fontSize:14,fontWeight:700}},"Â¥"+st.price.toLocaleString()),
                React.createElement("div",{style:{fontFamily:"mono",fontSize:10,color:st.change>=0?C.green:C.red}},(st.change>=0?"+":"")+st.changePct+"%")
              ),
              React.createElement("div",{style:{display:"flex",gap:4}},
                [{v:st.V,m:30,c:C.accent,l:"V"},{v:st.Q,m:30,c:C.purple,l:"Q"},{v:st.M,m:25,c:C.amber,l:"M"},{v:st.E,m:15,c:C.green,l:"E"}].map(x=>
                  React.createElement("div",{key:x.l,style:{width:36,textAlign:"center"}},React.createElement("div",{style:{fontSize:7,color:C.muted}},x.l),React.createElement(Bar,{v:x.v,max:x.m,color:x.c}),React.createElement("div",{style:{fontSize:9,fontFamily:"mono",color:x.c}},x.v))
                )
              ),
              React.createElement("div",{style:{textAlign:"center",minWidth:44}},
                React.createElement("div",{style:{fontSize:18,fontWeight:800,fontFamily:"mono",color:st.total>=65?C.green:st.total>=50?C.accent:C.muted}},st.total),
                React.createElement("div",{style:{fontSize:8,color:C.muted}},"/100")
              ),
              React.createElement(Badge,{score:st.total}),
              st.buyCandidate&&!held&&React.createElement("button",{onClick:e=>{e.stopPropagation();setModal({type:"buy",data:st});},style:{...btn,background:C.green,color:"#fff",fontSize:10,padding:"6px 10px"}},"è³¼å…¥è¨˜éŒ²")
            )
          )
        );
      })
    )
  );

  /* â”€â”€ Detail View â”€â”€ */
  const DetailView=()=>{
    const sc=allScored.find(x=>x.code===detail);if(!sc)return null;
    const held=portfolio.some(p=>p.code===detail);
    const Section=({title,details,score,max,color})=>React.createElement("div",{style:crd},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
        React.createElement("span",{style:{fontSize:12,fontWeight:700}},title),
        React.createElement("span",{style:{fontFamily:"mono",fontSize:15,fontWeight:800,color}},score,React.createElement("span",{style:{fontSize:10,color:C.muted}},"/"+max))
      ),
      React.createElement(Bar,{v:score,max:max,color}),
      React.createElement("div",{style:{marginTop:8}},details.map((d,i)=>React.createElement(Item,{key:i,d})))
    );
    return React.createElement("div",null,
      React.createElement("button",{onClick:()=>setView("screen"),style:{...btn,background:C.subtle,color:C.muted,marginBottom:10}},"â† æˆ»ã‚‹"),
      React.createElement("div",{style:{...crd,marginBottom:14}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:10}},
          React.createElement("div",null,
            React.createElement("div",{style:{fontFamily:"mono",fontSize:11,color:C.muted}},sc.code+".Tã€€"+sc.sector),
            React.createElement("div",{style:{fontSize:20,fontWeight:800,margin:"3px 0"}},sc.name),
            React.createElement("div",{style:{display:"flex",alignItems:"baseline",gap:8}},
              React.createElement("span",{style:{fontSize:28,fontWeight:800,fontFamily:"mono"}},"Â¥"+sc.price.toLocaleString()),
              React.createElement("span",{style:{fontSize:14,fontWeight:700,fontFamily:"mono",color:sc.change>=0?C.green:C.red}},(sc.change>=0?"+":"")+sc.changePct+"%")
            )
          ),
          React.createElement("div",{style:{textAlign:"right"}},
            React.createElement("div",{style:{fontSize:34,fontWeight:900,fontFamily:"mono",color:sc.total>=65?C.green:sc.total>=50?C.accent:C.muted}},sc.total,React.createElement("span",{style:{fontSize:13,color:C.muted}},"/100")),
            sc.sellDiscount>0&&React.createElement("div",{style:{fontSize:11,color:C.amber}},`ï¼ˆãƒ™ãƒ¼ã‚¹${sc.baseTotal} âˆ’ å£²å´ãƒªã‚¹ã‚¯${sc.sellDiscount}ptï¼‰`),
            React.createElement(Badge,{score:sc.total})
          )
        )
      ),
      sc.sellDiscount>0&&React.createElement("div",{style:{...crd,marginBottom:14,borderColor:C.amber+"40",background:"#1a1408"}},
        React.createElement("div",{style:{fontSize:12,fontWeight:700,color:C.amber,marginBottom:6}},`âš  å£²å´ãƒªã‚¹ã‚¯ãƒ‡ã‚£ã‚¹ã‚«ã‚¦ãƒ³ãƒˆï¼ˆâˆ’${sc.sellDiscount}ptï¼‰`),
        React.createElement("div",{style:{fontSize:11,color:C.text,lineHeight:1.8}},"ä»¥ä¸‹ã®å£²å´åŸºæº–ã«è¿‘ã„/åˆ°é”ã—ã¦ã„ã‚‹çŠ¶æ…‹ãŒæ¤œå‡ºã•ã‚ŒãŸãŸã‚ã€è³¼å…¥ã‚¹ã‚³ã‚¢ã‚’æ¸›ç‚¹ã—ã¦ã„ã¾ã™ã€‚"),
        sc.sellRiskFactors.map((f,i)=>React.createElement("div",{key:i,style:{fontSize:11,color:C.amber,padding:"3px 0",display:"flex",alignItems:"center",gap:6}},React.createElement("span",{style:{fontSize:9}},"âš¡"),f))
      ),
      sc.buyCandidate&&React.createElement("div",{style:{...crd,marginBottom:14,borderColor:C.green+"40",background:"#081a10"}},
        React.createElement("div",{style:{fontSize:12,fontWeight:700,color:C.green,marginBottom:8}},"ğŸ“‹ è³¼å…¥æ¨å¥¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"),
        React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:8}},
          [{l:"æ¨å¥¨æŠ•è³‡é¡",v:`Â¥${perUnit.toLocaleString()}`},{l:"æ¨å¥¨æ ªæ•°",v:`${Math.floor(perUnit/sc.price)}æ ª`},{l:"æƒ³å®šä¿æœ‰æœŸé–“",v:sc.holdPeriod},{l:"åˆ©ç¢ºãƒ©ã‚¤ãƒ³",v:`Â¥${sc.targetProfit.toLocaleString()}ï¼ˆ+20%ï¼‰`},{l:"æåˆ‡ãƒ©ã‚¤ãƒ³",v:`Â¥${sc.stopLoss.toLocaleString()}ï¼ˆâˆ’8%ï¼‰`},{l:"éç†±æ’¤é€€",v:"MA25ä¹–é›¢ç‡+15%è¶…"}].map(x=>
            React.createElement("div",{key:x.l,style:{background:C.bg,borderRadius:6,padding:8}},React.createElement("div",{style:{fontSize:9,color:C.muted}},x.l),React.createElement("div",{style:{fontSize:12,fontWeight:600,marginTop:2}},x.v))
          )
        ),
        !held&&React.createElement("button",{onClick:()=>setModal({type:"buy",data:sc}),style:{...btn,background:C.green,color:"#fff",width:"100%",marginTop:10,padding:"10px"}},"ã“ã®éŠ˜æŸ„ã®è³¼å…¥ã‚’è¨˜éŒ²")
      ),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}},
        React.createElement(Section,{title:"ãƒãƒªãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ30ptï¼‰",details:sc.vD,score:sc.V,max:30,color:C.accent}),
        React.createElement(Section,{title:"ã‚¯ã‚ªãƒªãƒ†ã‚£ï¼ˆ30ptï¼‰",details:sc.qD,score:sc.Q,max:30,color:C.purple}),
        React.createElement(Section,{title:"ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ï¼ˆ25ptï¼‰",details:sc.mD,score:sc.M,max:25,color:C.amber}),
        React.createElement(Section,{title:"ESGï¼ˆ15ptï¼‰",details:sc.eD,score:sc.E,max:15,color:C.green})
      )
    );
  };

  /* â”€â”€ Portfolio View â”€â”€ */
  const PortfolioView=()=>{
    const tI=portfolio.reduce((a,h)=>a+h.buyPrice*h.shares,0);
    const tC=portfolio.reduce((a,h)=>{const s=allScored.find(x=>x.code===h.code);return a+(s?s.price:h.buyPrice)*h.shares;},0);
    const tP=tC-tI;const rP=history.reduce((a,t)=>a+(t.pnl||0),0);
    return React.createElement("div",null,
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:14}},
        [{l:"æŠ•è³‡ç·é¡",v:"Â¥"+tI.toLocaleString(),c:C.text},{l:"è©•ä¾¡é¡",v:"Â¥"+tC.toLocaleString(),c:C.text},{l:"å«ã¿æç›Š",v:(tP>=0?"+":"")+"Â¥"+tP.toLocaleString(),c:tP>=0?C.green:C.red},{l:"å®Ÿç¾æç›Š",v:(rP>=0?"+":"")+"Â¥"+rP.toLocaleString(),c:rP>=0?C.green:C.red}].map(x=>
          React.createElement("div",{key:x.l,style:{...crd,textAlign:"center"}},React.createElement("div",{style:{fontSize:10,color:C.muted,marginBottom:3}},x.l),React.createElement("div",{style:{fontSize:16,fontWeight:700,fontFamily:"mono",color:x.c}},x.v))
        )
      ),
      React.createElement("div",{style:{fontSize:13,fontWeight:700,marginBottom:8}},`ä¿æœ‰éŠ˜æŸ„ï¼ˆ${portfolio.length}ä»¶ï¼‰`),
      portfolio.length===0?React.createElement("div",{style:{...crd,textAlign:"center",padding:32,color:C.muted}},"ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ç”»é¢ã‹ã‚‰è³¼å…¥è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„"):
      React.createElement("div",{style:{display:"grid",gap:6}},
        portfolio.map(h=>{
          const sc=allScored.find(x=>x.code===h.code);const cp=sc?sc.price:h.buyPrice;const pnl=(cp-h.buyPrice)*h.shares;const pct=((cp-h.buyPrice)/h.buyPrice*100).toFixed(2);const hasA=alerts.some(a=>a.id===h.id);
          return React.createElement("div",{key:h.id,style:{...crd,padding:"10px 14px",borderLeft:hasA?`3px solid ${C.red}`:`3px solid ${C.border}`}},
            React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:6}},
              React.createElement("div",{onClick:()=>{setDetail(h.code);setView("detail");},style:{cursor:"pointer"}},
                React.createElement("div",{style:{display:"flex",alignItems:"center",gap:6}},
                  React.createElement("span",{style:{fontFamily:"mono",fontSize:11,color:C.muted}},h.code),
                  React.createElement("span",{style:{fontSize:13,fontWeight:700}},h.name),
                  hasA&&React.createElement("span",{style:{fontSize:8,background:C.red+"20",color:C.red,padding:"2px 5px",borderRadius:4}},"âš å£²å´æ¨å¥¨")
                ),
                React.createElement("div",{style:{fontSize:10,color:C.muted}},`${h.shares}æ ª Ã— Â¥${h.buyPrice.toLocaleString()} = Â¥${(h.shares*h.buyPrice).toLocaleString()}ã€€${h.buyDate}`)
              ),
              React.createElement("div",{style:{display:"flex",alignItems:"center",gap:12}},
                React.createElement("div",{style:{textAlign:"right"}},
                  React.createElement("div",{style:{fontFamily:"mono",fontSize:14,fontWeight:700}},"Â¥"+cp.toLocaleString()),
                  React.createElement("div",{style:{fontFamily:"mono",fontSize:11,color:pnl>=0?C.green:C.red,fontWeight:600}},(pnl>=0?"+":"")+"Â¥"+pnl.toLocaleString()+` (${pnl>=0?"+":""}${pct}%)`)
                ),
                React.createElement("button",{onClick:()=>setModal({type:"sell",data:h}),style:{...btn,background:C.red+"20",color:C.red,fontSize:10}},"å£²å´")
              )
            )
          );
        })
      ),
      history.length>0&&React.createElement(React.Fragment,null,
        React.createElement("div",{style:{fontSize:13,fontWeight:700,marginTop:18,marginBottom:8}},`å–å¼•å±¥æ­´ï¼ˆ${history.length}ä»¶ï¼‰`),
        React.createElement("div",{style:{display:"grid",gap:5}},
          history.slice().reverse().map((t,i)=>
            React.createElement("div",{key:i,style:{...crd,padding:"8px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"}},
              React.createElement("div",null,React.createElement("span",{style:{fontSize:12,fontWeight:600}},t.code+" "+t.name),React.createElement("div",{style:{fontSize:10,color:C.muted}},`${t.buyDate}â†’${t.sellDate}ã€€${t.shares}æ ª`)),
              React.createElement("div",{style:{fontFamily:"mono",fontSize:13,fontWeight:700,color:t.pnl>=0?C.green:C.red}},(t.pnl>=0?"+":"")+"Â¥"+(t.pnl||0).toLocaleString())
            )
          )
        )
      )
    );
  };

  /* â”€â”€ Main Render â”€â”€ */
  return React.createElement("div",null,
    React.createElement("div",{style:{background:"linear-gradient(135deg,#0c1220,#1a0f30)",borderBottom:`1px solid ${C.border}`,padding:"10px 18px",position:"sticky",top:0,zIndex:100}},
      React.createElement("div",{style:{maxWidth:1100,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},
          React.createElement("div",{style:{width:30,height:30,borderRadius:7,background:`linear-gradient(135deg,${C.accent},${C.purple})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:13}},"ğŸ“ˆ"),
          React.createElement("div",null,
            React.createElement("div",{style:{fontSize:14,fontWeight:800}},"Stock Screener Pro"),
            React.createElement("div",{style:{fontSize:8,color:C.muted}},"V+Q+M+ESGï¼100ptï½œå£²å´ãƒªã‚¹ã‚¯ãƒ‡ã‚£ã‚¹ã‚«ã‚¦ãƒ³ãƒˆæ­è¼‰")
          )
        ),
        React.createElement("div",{style:{display:"flex",gap:3}},
          [{k:"screen",l:"ğŸ” ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"},{k:"portfolio",l:"ğŸ’¼ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª"}].map(t=>
            React.createElement("button",{key:t.k,onClick:()=>setView(t.k),style:{...btn,fontSize:11,background:(view===t.k||(view==="detail"&&t.k==="screen"))?C.accent+"25":"transparent",color:(view===t.k||(view==="detail"&&t.k==="screen"))?C.accent:C.muted,border:`1px solid ${(view===t.k||(view==="detail"&&t.k==="screen"))?C.accent+"50":"transparent"}`}},t.l,t.k==="portfolio"&&alerts.length>0&&React.createElement("span",{style:{marginLeft:4,background:C.red,color:"#fff",fontSize:8,padding:"1px 4px",borderRadius:8}},alerts.length))
          ),
          React.createElement("button",{onClick:()=>setModal({type:"settings"}),style:{...btn,background:"transparent",color:C.muted,fontSize:11}},
            "âš™",apiStatus.connected&&React.createElement("span",{style:{marginLeft:3,width:6,height:6,borderRadius:3,background:C.green,display:"inline-block"}})
          )
        )
      )
    ),
    React.createElement("div",{style:{maxWidth:1100,margin:"0 auto",padding:"14px 18px"}},
      React.createElement("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"}},
        [{l:"å¯¾è±¡",v:SAMPLE.length,c:C.text},{l:"è³¼å…¥å€™è£œ",v:buyCandidates.length,c:C.green},{l:"ä¿æœ‰",v:portfolio.length,c:C.purple},{l:"ï½±ï¾—ï½°ï¾„",v:alerts.length,c:alerts.length>0?C.red:C.muted},{l:"1éŠ˜æŸ„",v:"Â¥"+perUnit.toLocaleString(),c:C.accent},{l:"ãƒ‡ãƒ¼ã‚¿",v:apiStatus.dataSource,c:apiStatus.connected?C.green:C.amber}].map(x=>
          React.createElement("div",{key:x.l,style:{background:C.card,border:`1px solid ${C.border}`,borderRadius:7,padding:"6px 12px",display:"flex",alignItems:"center",gap:6}},
            React.createElement("span",{style:{fontSize:9,color:C.muted}},x.l),
            React.createElement("span",{style:{fontSize:12,fontWeight:700,fontFamily:"mono",color:x.c}},x.v)
          )
        )
      ),
      view==="screen"&&React.createElement(ScreenView),
      view==="portfolio"&&React.createElement(PortfolioView),
      view==="detail"&&React.createElement(DetailView),
      React.createElement("div",{style:{marginTop:18,padding:"10px 14px",background:"#100e1c",borderRadius:8,border:"1px solid #2a2555"}},
        React.createElement("div",{style:{fontSize:9,color:"#818cf8",fontWeight:600,marginBottom:2}},"âš  ãƒ‡ã‚£ã‚¹ã‚¯ãƒ¬ãƒ¼ãƒãƒ¼"),
        React.createElement("div",{style:{fontSize:9,color:C.muted,lineHeight:1.8}},"æœ¬ãƒ„ãƒ¼ãƒ«ã®å£²è²·ã‚·ã‚°ãƒŠãƒ«ãƒ»ã‚¹ã‚³ã‚¢ã¯æ©Ÿæ¢°çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹å‚è€ƒæƒ…å ±ã§ã‚ã‚Šã€æŠ•è³‡åŠ©è¨€ãƒ»å‹§èª˜ã«ã¯è©²å½“ã—ã¾ã›ã‚“ã€‚å®Ÿéš›ã®æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§è¡Œã„ã€å¿…è¦ã«å¿œã˜ã¦é‡‘èå°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚ESGã‚¹ã‚³ã‚¢ã¯ç°¡æ˜“è©•ä¾¡ã§ã‚ã‚Šç¬¬ä¸‰è€…æ ¼ä»˜æ©Ÿé–¢ã®è©•ä¾¡ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚")
      )
    ),
    modal&&modal.type==="buy"&&React.createElement(BuyModal),
    modal&&modal.type==="sell"&&React.createElement(SellModal),
    modal&&modal.type==="settings"&&React.createElement(SettingsModal)
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
